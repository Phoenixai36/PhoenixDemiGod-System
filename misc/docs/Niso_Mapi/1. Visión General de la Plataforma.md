<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" class="logo" width="120"/>

## 1. Visión General de la Plataforma

Phoenix DemiGod v8.7 se orquesta como **malla de micro-servicios AI** que aloja modelos sin Transformers (Mamba/SSM, RWKV, Jamba, etc.) cuantizados vía GGUF.
El stack se articula en cuatro planos:


| Plano | Función principal | Tecnologías clave |
| :-- | :-- | :-- |
| Ingesta \& Routing | Clasifica la petición y dirige al modelo óptimo | FastAPI Router, **vLLM** sidecars |
| Core Inferencia | Instancias de modelos en contenedores aislados | Podman, llama.cpp, TensorRT-LLM |
| Orquestación \& Automatización | CI/CD, escalado y workflows | Windmill, n8n, GitHub Actions |
| Observabilidad \& SRE | Telemetría, alertas y auto-healing | Prometheus, Grafana, Loki, Alertmanager |

## 2. Flujo DevOps End-to-End

### 2.1 Control de Versiones \& GitOps

1. Repositorio monorepo en **GitHub** con directorios `models/`, `infra/`, `services/` y `workflows/`.
2. Rama `main` protegida; PRs validadas por:
    - Lint de código (`ruff`, `black`).
    - Pruebas unitarias de enrutado y consenso multi-modelo.
    - Evaluaciones automáticas de regresión de calidad (benchmarks lm-eval-harness).

> Definición: **GitOps** – práctica que declara estado deseado de la infraestructura en Git; cualquier cambio se realiza vía pull request y la convergencia es automática mediante controladores.

### 2.2 Integración Continua (CI)

- **GitHub Actions** ejecuta matrices para CPU y GPU.
- Construcción de imágenes OCI con **Podman-build**; etiquetas semver + hash.
- Publicación en **Harbor** privado; firma de containers con cosign.

> Definición: **OCI Image** – estándar abierto de paquetes contenedorizados interoperables con Docker/Podman.

### 2.3 Entrega \& Despliegue Continuo (CD)

- **Windmill** detecta nueva etiqueta y aplica manifiestos **Terraform** (IaC) en el clúster bare-metal (Debian+systemd-nspawn).
- Rolling update canario con _pod disruption budget_ ≤ 20%.
- **n8n** desencadena pruebas de humo y notifica en Matrix / Slack.

> Definición: **Canary Deployment** – estrategia que libera nuevas versiones a un subconjunto de tráfico para minimizar riesgos.

## 3. Infraestructura como Código (IaC)

```hcl
module "router" {
  source   = "./modules/fastapi"
  replicas = var.router_replicas
  gpu      = false
}

module "mamba7b" {
  source       = "./modules/model"
  model_name   = "Falcon-Mamba-7B"
  quantization = "Q4_0"
  gpu          = true
}
```

- **Terraform 0.15** gestiona nodos, volúmenes ZFS y redes CNI.
- Git tags `phase-1`, `phase-2`… controlan drifts entre entornos _dev_, _stage_ y _prod_.

> Definición: **Drift Detection** – comparación continua entre estado real y declarativo para evitar configuraciones divergentes.

## 4. Ciclo de Vida del Modelo

| Etapa | Automación | Toolchain |
| :-- | :-- | :-- |
| Ingesta pesos | Pull desde Hugging Face o repos privado | `hf_hub_download`, Rclone |
| Conversión | `transformers->gguf` + post-quant Int4 | llama.cpp converter |
| Validación | Perplexity, Hemlock suite | Windmill task |
| Promoción | Etiquetas `candidate`, `stable` | GitHub Releases |
| Retirada | TTL 90 días, snapshot en MinIO | Cronjob |

## 5. Observabilidad \& SRE

- **Prometheus** scrapea métricas de uso de GPU, latencia p50/p95 y tasa de errores.
- **Grafana** dashboards por modelo y tenant.
- **Loki** centraliza logs estructurados; **Alertmanager** dispara PagerDuty si p95 > 3 s.
- Health-checks HTTP light *vs.* deep LLM probes con prompts sintéticos.

> Definición: **p95 latency** – valor bajo el cual se sitúa el 95% de las peticiones; métrica clave de experiencia de usuario.

## 6. Seguridad y Cumplimiento

- Autenticación OIDC con Keycloak; emisión de JWT de acceso a modelos.
- Escaneo SCA (Trivy) y CVE gating.
- Política **WAF** (Caddy Server) con reglas específicas para _prompt injection_.
- Logs firmados (RFC 3161) para trazabilidad – requisito AI Act Annex IV.

> Definición: **Prompt Injection** – ataque que manipula la entrada al modelo para alterar su salida o filtrar datos sensibles.

## 7. Escalabilidad \& Costes

- Modelos ligeros (≤ 7 B) fijados en CPU hosts; modelos > 12 B migran a nodos GPU RTX 4090.
- **HPA** basado en _queue length_ y VRAM; escalado vertical vía CloudInit + PCIe passthrough.
- Reserva de potencia con **Spot VMs** en IONOS Bare Metal Flex para horas punta.

> Definición: **HPA (Horizontal Pod Autoscaler)** – ajusta el número de réplicas según métricas de carga.

## 8. Roadmap de Fases (12 meses)

| Mes | Fase | Objetivo DevOps | Indicador éxito |
| :-- | :-- | :-- | :-- |
| 0-3 | Fase 1 | CI/CD básico, despliegue Zamba2-2.7B | MTTR < 30 min |
| 3-5 | Fase 2 | Router multi-modelo, canary rollout | p95 latencia < 2 s |
| 5-8 | Fase 3 | Observabilidad 360°, políticas WAF | 0 CVEs críticas en imágenes |
| 8-12 | Fase 4 | Escalado global, DR en otra región | RPO ≤ 15 min |

## 9. Oportunidades de Financiación 2025

- **ENISA Emprendedoras Digitales** (préstamo blando < 200 k€).
- **Programa  Neotec 2025** (CDTI) – subvención hasta 70% de I+D.
- **BerriUp Batch-14** – aceleración + 50 k€, mentoría DevOps.
- **LANCER-AI Angels** – tickets de 25-75 k€ para proyectos LLM open-source.

Cada solicitud prepara **one-pager** con métricas p95, ahorro energético Mamba vs Transformers y políticas AI Act.

## 10. Glosario Rápido

| Término | Definición | Lógica Ideal \& Tools |
| :-- | :-- | :-- |
| **Windmill** | Orquestrador de workflows tipo Airflow as-code | Automatiza pipelines CI/CD y pruebas de modelo |
| **n8n** | Plataforma no-code de integraciones | Orquesta triggers, notifica y llama micro-servicios |
| **Podman** | Runtime OCI raíz-less compatible Docker | Aísla modelos, menos superficie ataque |
| **vLLM** | Runtime inferencia high-throughput | Carga múltiples checkpoints y sirve a FastAPI |
| **MinIO** | Almacenamiento S3 on-prem | Guarda checkpoints, backups y datasets |
| **Harbor** | Registro OCI con escaneo CVE | Controla firmas y retenciones de imágenes |

### Resumen No Técnico

Se ha diseñado un circuito DevOps completo para Phoenix DemiGod que permite subir, probar y liberar rápidamente modelos Mamba, RWKV y similares sin Transformers, manteniendo tiempos de respuesta bajos y alta seguridad. La infraestructura se declara en código, se despliega automáticamente y se controla con métricas en tiempo real. Con este enfoque, el proyecto puede crecer de forma ordenada dentro de los plazos y acceder a programas públicos y privados de financiación tecnológica.

NEXT FASE? (FASE 3: OBSERVABILIDAD Y ESCALADO)

